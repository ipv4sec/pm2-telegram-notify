"use strict";
const pmx = require('pmx');
const pm2 = require('pm2');
const TelegramBot = require('node-telegram-bot-api');
let probe = pmx.probe();
let conf = pmx.initModule({
    widget: {
        type: 'generic',
        logo: 'http://www.creativetechs.com/iq/tip_images/TerminalApp-Icon.png',
        theme: ['#111111', '#1B2228', '#807C7C', '#807C7C'],
        el: {
            probes: false,
            actions: false
        },
        block: {
            actions: false,
            issues: false,
            meta: false,
            cpu: false,
            mem: false,
            main_probes: ['chatId', 'token']
        }
    }
});
probe.metric({
    name: 'chatId',
    value: function () {
        return conf.chatId;
    }
});
probe.metric({
    name: 'token',
    value: function () {
        return conf.token;
    }
});
const bot = new TelegramBot(conf.token, { polling: true });
pm2.launchBus(function (err, bus) {
    if (err) {
        throw err;
    }
    bus.on('process:event', function (e) {
        if (e.manually === true) {
            return;
        }
        else {
            if (e.event === 'restart overlimit') {
                let resuly = `${e.process.name} [ pid:${e.process.pm_id}] @ ${e.process.HOSTNAME}:${e.process.status} in ${e.process.pm_exec_path}`;
                bot.sendMessage(conf.chatId, resuly, { parse_mode: 'Markdown' });
            }
            else {
                return;
            }
        }
    });
    bus.on('pm2:kill', function () {
        console.error('PM2 is beeing killed');
    });
});
bot.on('message', (msg) => {
    const chatId = msg.chat.id;
    bot.sendMessage(chatId, 'You chatId is ' + chatId);
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,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RixHQUFHLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxDQUFDLEdBQVE7SUFDekIsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUE7SUFDMUIsR0FBRyxDQUFDLFdBQVcsQ0FBQyxNQUFNLEVBQUMsZ0JBQWdCLEdBQUcsTUFBTSxDQUFFLENBQUE7QUFDcEQsQ0FBQyxDQUFDLENBQUEiLCJmaWxlIjoiYXBwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgcG14ID0gcmVxdWlyZSgncG14JylcclxuY29uc3QgcG0yID0gcmVxdWlyZSgncG0yJylcclxuY29uc3QgVGVsZWdyYW1Cb3QgPSByZXF1aXJlKCdub2RlLXRlbGVncmFtLWJvdC1hcGknKVxyXG5sZXQgcHJvYmUgPSBwbXgucHJvYmUoKVxyXG5sZXQgY29uZiA9IHBteC5pbml0TW9kdWxlKHtcclxuICB3aWRnZXQgOiB7XHJcbiAgICB0eXBlICAgICAgICAgICAgIDogJ2dlbmVyaWMnLFxyXG4gICAgbG9nbyAgICAgICAgICAgICA6ICdodHRwOi8vd3d3LmNyZWF0aXZldGVjaHMuY29tL2lxL3RpcF9pbWFnZXMvVGVybWluYWxBcHAtSWNvbi5wbmcnLFxyXG4gICAgdGhlbWUgICAgICAgICAgICA6IFsnIzExMTExMScsICcjMUIyMjI4JywgJyM4MDdDN0MnLCAnIzgwN0M3QyddLFxyXG4gICAgZWwgOiB7XHJcbiAgICAgIHByb2JlcyAgOiBmYWxzZSxcclxuICAgICAgYWN0aW9ucyA6IGZhbHNlXHJcbiAgICB9LFxyXG4gICAgYmxvY2sgOiB7XHJcbiAgICAgIGFjdGlvbnMgOiBmYWxzZSxcclxuICAgICAgaXNzdWVzICA6IGZhbHNlLFxyXG4gICAgICBtZXRhICAgIDogZmFsc2UsXHJcbiAgICAgIGNwdTogZmFsc2UsXHJcbiAgICAgIG1lbTogZmFsc2UsXHJcbiAgICAgIG1haW5fcHJvYmVzIDogWydjaGF0SWQnLCAndG9rZW4nXVxyXG4gICAgfVxyXG4gIH1cclxufSlcclxuXHJcbnByb2JlLm1ldHJpYyh7XHJcbiAgbmFtZTogJ2NoYXRJZCcsXHJcbiAgdmFsdWU6IGZ1bmN0aW9uICgpIHtcclxuICAgIHJldHVybiBjb25mLmNoYXRJZFxyXG4gIH1cclxufSlcclxuXHJcbnByb2JlLm1ldHJpYyh7XHJcbiAgbmFtZTogJ3Rva2VuJyxcclxuICB2YWx1ZTogZnVuY3Rpb24gKCkge1xyXG4gICAgcmV0dXJuIGNvbmYudG9rZW5cclxuICB9XHJcbn0pXHJcbmNvbnN0IGJvdCA9IG5ldyBUZWxlZ3JhbUJvdChjb25mLnRva2VuLCB7cG9sbGluZzogdHJ1ZX0pXHJcbnBtMi5sYXVuY2hCdXMoZnVuY3Rpb24gKGVycjogRXJyb3IsIGJ1czogYW55KSB7XHJcbiAgaWYgKGVycikge1xyXG4gICAgdGhyb3cgZXJyXHJcbiAgfVxyXG4gIGJ1cy5vbigncHJvY2VzczpldmVudCcsIGZ1bmN0aW9uIChlOiBhbnkpIHtcclxuICAgIGlmIChlLm1hbnVhbGx5ID09PSB0cnVlKSB7XHJcbiAgICAgIHJldHVyblxyXG4gICAgfWVsc2V7XHJcbiAgICAgIGlmKCBlLmV2ZW50ID09PSAncmVzdGFydCBvdmVybGltaXQnKXtcclxuICAgICAgICBsZXQgcmVzdWx5OiBzdHJpbmcgPVxyXG4gICAgICAgICAgICBgJHsgZS5wcm9jZXNzLm5hbWV9IFsgcGlkOiR7IGUucHJvY2Vzcy5wbV9pZH1dIEAgJHsgZS5wcm9jZXNzLkhPU1ROQU1FfTokeyBlLnByb2Nlc3Muc3RhdHVzfSBpbiAkeyBlLnByb2Nlc3MucG1fZXhlY19wYXRofWBcclxuICAgICAgICBib3Quc2VuZE1lc3NhZ2UoY29uZi5jaGF0SWQsIHJlc3VseSwgeyBwYXJzZV9tb2RlOiAnTWFya2Rvd24nIH0pXHJcbiAgICAgIH1lbHNle1xyXG4gICAgICAgIHJldHVyblxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSlcclxuICBidXMub24oJ3BtMjpraWxsJywgZnVuY3Rpb24gKCkge1xyXG4gICAgY29uc29sZS5lcnJvcignUE0yIGlzIGJlZWluZyBraWxsZWQnKVxyXG4gIH0pXHJcbn0pXHJcbmJvdC5vbignbWVzc2FnZScsIChtc2c6IGFueSkgPT4ge1xyXG4gIGNvbnN0IGNoYXRJZCA9IG1zZy5jaGF0LmlkXHJcbiAgYm90LnNlbmRNZXNzYWdlKGNoYXRJZCwnWW91IGNoYXRJZCBpcyAnICsgY2hhdElkIClcclxufSlcclxuIl19
